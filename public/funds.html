<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <!-- https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP -->
    <!-- <meta http-equiv="Content-Security-Policy" content="default-src 'self' ; script-src 'self' ; style-src 'self' "> -->

    <!-- React.js / Babel CDN docs -->
    <script src="./src/reactDev.js" crossorigin></script>
    <script src="./src/reactDocDev.js" crossorigin></script>
    <script src='./src/babel.js'></script>
    <!-- sweet alert() -->
    <script src="./src/sweetAlert.js"></script>
    <!-- <script src="https://unpkg.com/react@17/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js" crossorigin></script> -->


    <link rel="stylesheet" href="./src/bulmaMin.css">
    <link href="./styles.css" rel="stylesheet">
    <title>Funds</title>

</head>

<body>
    <div id="FundsPage"></div>

    <script src="./components/Navbar.js" type="text/babel"></script>
    <script type="text/babel">

        const FundsPage = () => {
            const [userFundBalance, setUserFundBalance] = React.useState(0)
            const [fundTransactions, setFundTransactions] = React.useState([]);

            React.useEffect(() => {
                window.backend.fundTransactionHistory(sessionStorage.getItem('uuid')).then((res) => {
                    // save the transactions
                    setFundTransactions(res)
                    //calculate the fund balance of the user
                    var fundBalance = 0
                    res.forEach((item) => {
                        if (item.type == 'Deposit') fundBalance = fundBalance + item.amount;
                        else if (item.type == 'Withdraw') fundBalance = fundBalance - item.amount;
                    })
                    setUserFundBalance(fundBalance);
                    // render the transactions history 
                });
            }, []);

            function handleFundTransaction(type) {
                swal(`Enter Amount to ${type}.`, {
                    content: "input",
                })
                    .then((amount) => {
                        if (amount === null) {
                            swal("Transaction Cancelled.");
                        } else if (Number(amount) <= 0) {
                            swal("Amount should be greater than zero.");
                        } else {
                            window.backend.fundTransaction(sessionStorage.getItem('uuid'), type, Number(amount)).then((res) => {
                                swal("Transaction SuccessFul.");
                                window.location.reload();
                            })
                        }
                    });
            }

            return (<div className="container">
                <div className="fundsSummaryCard has-text-centered">
                    <p className="is-size-2 mt-1 ml-3">Funds Balance </p>
                    <p className="is-size-3 mt-1 ml-5 has-text-weight-bold">â‚¹ {userFundBalance} </p>
                    <div className="tradeTab is-flex is-justify-content-center mt-4">
                        <button className="button is-success is-normal" onClick={() => handleFundTransaction('Deposit')}>Deposit</button>
                        <button className="button is-link is-normal" onClick={() => handleFundTransaction('Withdraw')} >Withdraw</button>
                    </div>
                </div>
            </div>)
        }



        ReactDOM.render(
            <React.StrictMode>
                <Navbar page={"Funds"} />
                <FundsPage />
            </React.StrictMode>
            , document.getElementById('FundsPage'));
    </script>



</body>

</html>