<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <!-- https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP -->
    <!-- <meta http-equiv="Content-Security-Policy" content="default-src 'self' ; script-src 'self' ; style-src 'self' "> -->

    <!-- React.js / Babel CDN docs -->
    <script src="./src/reactDev.js" crossorigin></script>
    <script src="./src/reactDocDev.js" crossorigin></script>
    <script src='./src/babel.js'></script>
    <!-- <script src="https://unpkg.com/react@17/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js" crossorigin></script> -->


    <link rel="stylesheet" href="./src/bulmaMin.css">
    <link href="./styles.css" rel="stylesheet">
    <title>Trade</title>

</head>

<body>
    <div id="TradePage"></div>

    <script src="./components/Navbar.js" type="text/babel"></script>
    <script type="text/babel">

        const TradePage = () => {
            const [companySelected, setCompanySelected] = React.useState({});  // the company that we will trade on
            const [companyIndex, setCompanyIndex] = React.useState(); // the copy of the entire index
            const [searchResults, setSearchResults] = React.useState([]); // array of the current search string


            React.useEffect(() => {
                window.backend.getCompanyIndexes().then((res) => setCompanyIndex(res));
            }, []);

            // function will add the selected companies data to the trade execution card
            function selectingCompany(cuid) {
                var foundCompany = {};
                companyIndex.forEach(item => {
                    if (item.cuid === cuid) foundCompany = item;
                })
                setCompanySelected(foundCompany);
            }

            // finds the company by string matching either similar name OR symbol
            function searchCompanies(searchString) {
                setSearchResults(companyIndex.map((item) => {
                    if (item.name.toLowerCase().includes(searchString) || item.symbol == searchString.toUpperCase()) {
                        return (<li key={item.cuid}><a className="has-text-link has-text-weight-semibold" onClick={() => selectingCompany(item.cuid)}>{item.name}</a></li>)
                    }
                    return null
                }))
            }

            return (
                <div className="container">
                    <div className="searchSection">
                        <nav>
                            <input className="input is-rounded" type="text" onChange={(e) => searchCompanies(e.target.value)} placeholder="Search Company Name." />
                        </nav>
                        <div className="searchResults">
                            <aside className="menu">
                                <ul className="menu-list">
                                    {searchResults}
                                </ul>
                            </aside>
                        </div>
                    </div>

                    <div className="tradeInfoCard">

                        <p className="is-size-5 mt-1">Ticker Symbol : {companySelected.symbol}</p>
                        <p className="is-size-5">Company Name  : {companySelected.name}</p>
                        <br />
                        <p className="is-size-6">Current Price : â‚¹{companySelected.price_today}</p>
                        <p className="is-size-6">Todays Change : {companySelected.change_percentage}%</p>
                        <br />
                        <p className="is-size-6">Your Total Holdings :</p>
                        <p className="is-size-6">Total Holding Value :</p>
                        <p className="is-size-6">Total Funds Balance :</p>
                        <br />
                        <div className="tradeTab">
                            <input className="input is-small" type="text" placeholder="Enter Quantity." />
                            <button className="button is-success is-small">BUY</button>
                            <button className="button is-danger is-small">SELL</button>
                        </div>
                        <p className="is-italic m-2 has-text-danger">Lorem, ipsum dolor.</p>
                    </div>
                </div>

            )
        }



        ReactDOM.render(
            <React.StrictMode>
                <Navbar page={"Trade"} />
                <TradePage />
            </React.StrictMode>
            , document.getElementById('TradePage'));
    </script>



</body>

</html>